# 数据论文模板规则配置
# 基于：数据论文模板（刘尚亮修正版）.docx
# 生成时间：2026-01-14

description: "数据论文模板格式检查规则"

# 导入基础规则（可选）
# import:
#   - "base.yaml"

rules:
  # ============================================================================
  # 1. 首页必要元素检查
  # ============================================================================
  # 注意：数据论文没有单独的封面，首页直接包含：标题、作者、摘要、关键词

  - id: "TITLE-001"
    enabled: true
    params:
      description: "首页第一个段落必须是论文标题（不能为空）"
      target_blocks: [0] # 检查第0个block（首页第一段）
      min_length: 5 # 标题至少5个字符

  - id: "ABSTRACT-001"
    enabled: true
    params:
      description: "首页必须包含中文摘要"
      keywords: ["摘要"]
      check_first_n_blocks: 15
      min_keyword_matches: 1

  - id: "ABSTRACT-002"
    enabled: true
    params:
      description: "首页必须包含英文摘要"
      keywords: ["Abstract"]
      check_first_n_blocks: 20
      min_keyword_matches: 1

  - id: "KEYWORDS-001"
    enabled: true
    params:
      description: "首页必须包含关键词"
      keywords: ["关键词", "Keywords"]
      check_first_n_blocks: 20
      min_keyword_matches: 1

  # ============================================================================
  # 2. 结构完整性检查
  # ============================================================================

  - id: "STRUCT-001"
    enabled: true
    params:
      description: "必须包含'引言'或'概述'章节"
      title_text: "引  言"
      alternative_titles:
        - "引言"
        - "概  述"
        - "概述"
      style_prefixes: ["Heading"]

  - id: "STRUCT-002"
    enabled: true
    params:
      description: "必须包含'数据采集和处理方法'章节"
      keywords:
        - "数据采集"
        - "处理方法"
      style_prefixes: ["Heading"]

  - id: "STRUCT-003"
    enabled: true
    params:
      description: "必须包含'数据样本描述'章节"
      keywords:
        - "数据样本"
        - "样本描述"
      style_prefixes: ["Heading"]

  - id: "STRUCT-004"
    enabled: true
    params:
      description: "必须包含'数据质量控制和评估'章节"
      keywords:
        - "数据质量"
        - "质量控制"
        - "质量评估"
      style_prefixes: ["Heading"]

  - id: "STRUCT-005"
    enabled: true
    params:
      description: "必须包含'数据价值和保藏计划'章节"
      keywords:
        - "数据价值"
        - "保藏计划"
      style_prefixes: ["Heading"]

  - id: "STRUCT-006"
    enabled: true
    params:
      description: "必须包含'数据使用方法和建议'章节"
      keywords:
        - "数据使用"
        - "使用方法"
      style_prefixes: ["Heading"]

  - id: "STRUCT-007"
    enabled: true
    params:
      description: "必须包含'数据可用性声明'章节"
      keywords:
        - "数据可用性"
        - "可用性声明"
      style_prefixes: ["Heading"]

  # ============================================================================
  # 3. 标题规则
  # ============================================================================

  - id: "HDG-001"
    enabled: true
    params:
      description: "各级标题的编号应该连续"
      check_heading_numbering: true
      heading_styles:
        - "Heading 1"
        - "Heading 2"
        - "Heading 3"
        - "Heading 4"

  - id: "HDG-002"
    enabled: true
    params:
      description: "一级标题样式检查（Heading 2 = 4号宋体）"
      target_style: "Heading 2"
      expected_font_name: "宋体"
      expected_font_size: 228600 # 4号 = 14pt = 14*635 = 8890 twips (实际可能需要调整)
      font_name_alternatives: ["Times New Roman"] # 西文字体

  - id: "HDG-003"
    enabled: true
    params:
      description: "二级标题样式检查（Heading 3 = 小4号宋体）"
      target_style: "Heading 3"
      expected_font_name: "宋体"
      expected_font_size: 190500 # 小4号 = 12pt
      font_name_alternatives: ["Times New Roman"]

  - id: "HDG-004"
    enabled: true
    params:
      description: "三级标题样式检查（Heading 4 = 5号宋体）"
      target_style: "Heading 4"
      expected_font_name: "宋体"
      expected_font_size: 158750 # 5号 = 10.5pt
      font_name_alternatives: ["Times New Roman"]

  # ============================================================================
  # 4. 段落规则
  # ============================================================================

  - id: "PAR-001"
    enabled: true
    params:
      description: "正文段落必须是1.15倍行距或1.5倍行距"
      target_styles: ["Normal", "Body Text"]
      allowed_line_spacing: [1.15, 1.5]
      tolerance: 0.05

  - id: "PAR-002"
    enabled: true
    params:
      description: "检查连续空段落"
      max_consecutive_empty: 2
      check_page_breaks: true

  - id: "PAR-003"
    enabled: true
    params:
      description: "正文段落末尾必须使用句号或冒号"
      required_punctuation: ["。", "：", "；", "！", "？"]
      min_paragraph_length: 20
      check_styles: ["Normal", "Body Text"]

  - id: "PAR-004"
    enabled: true
    params:
      description: "中文字符之间不能有一个或多个空格"
      check_chinese_spacing: true
      allow_exceptions: false

  - id: "PAR-005"
    enabled: true
    params:
      description: "中文不能被成对的英文双引号或英文单引号包围"
      check_english_quotes: true
      allowed_patterns: []

  - id: "PAR-006"
    enabled: true
    params:
      description: "中文引号应该左右匹配"
      quote_pairs:
        - ["\u201c", "\u201d"] # "" 中文双引号
        - ["\u2018", "\u2019"] # '' 中文单引号
        - ["\u300a", "\u300b"] # 《》书名号
        - ["\u3008", "\u3009"] # 〈〉
        - ["\u3010", "\u3011"] # 【】
        - ["\uff08", "\uff09"] # （）全角括号

  - id: "PAR-007"
    enabled: true
    params:
      description: "段落之间不要存在连续空行"
      max_consecutive_empty_lines: 1

  # ============================================================================
  # 5. 参考文献规则
  # ============================================================================

  - id: "REF-001"
    enabled: true
    params:
      description: "文档必须包含参考文献章节"
      title_text: "参考文献"
      alternative_titles: ["References", "引用文献"]
      style_prefixes: ["Heading"]

  - id: "REF-002"
    enabled: true
    params:
      description: "参考文献必须在正文中通过上标引用"
      check_superscript_citations: true
      citation_patterns:
        - "\\[\\d+\\]" # [1], [2] 等
        - "\\[\\d+-\\d+\\]" # [1-3] 等
        - "\\[\\d+,\\s*\\d+\\]" # [1, 2] 等

  - id: "REF-003"
    enabled: true
    params:
      description: "参考文献必须是一级标题（Heading 2）"
      heading_text: "参考文献"
      required_level: 2 # Heading 2
      alternative_texts: ["References"]

  # ============================================================================
  # 6. 图表规则
  # ============================================================================

  - id: "FIG-001"
    enabled: true
    params:
      description: "如果有图，必须包含插图目录或图列表"
      title_text: "图"
      alternative_titles: ["插图目录", "图目录", "图表"]
      style_prefixes: ["Heading", "TOC"]
      optional: true # 可选检查，只在发现图片时触发

  - id: "FIG-002"
    enabled: true
    params:
      description: "图的题注必须在图后面"
      caption_pattern: "图\\s*\\d+"
      caption_position: "after" # after 或 before

  - id: "TBL-001"
    enabled: true
    params:
      description: "如果有表格，必须包含附表目录或表列表"
      title_text: "表"
      alternative_titles: ["附表目录", "表目录", "表格"]
      style_prefixes: ["Heading", "TOC"]
      optional: true

  - id: "TBL-002"
    enabled: true
    params:
      description: "表格的题注必须在表格前面"
      caption_pattern: "表\\s*\\d+"
      caption_position: "before"

  - id: "T-001"
    enabled: true
    params:
      description: "表格必须有标题行和足够的内容行"
      min_rows: 2
      min_cols: 2
      check_header_row: true

  # ============================================================================
  # 7. 字体和格式规则
  # ============================================================================

  - id: "FONT-001"
    enabled: true
    params:
      description: "论文标题字体要求：中文黑体，西文Times New Roman，3号加粗"
      target_blocks: [0] # 只检查第0个block（首页第一段）
      expected_font_name: "黑体"
      font_name_alternatives: ["Times New Roman"] # 西文字体
      expected_font_size: 203200 # 3号 = 16pt = 203200 EMUs
      expected_bold: true

  - id: "PAR-001-TITLE"
    enabled: true
    params:
      description: "论文标题段落格式要求：居中，段前段后各0.5行距"
      target_blocks: [0] # 只检查第0个block（首页第一段）
      alignment: "center" # 居中
      # 段前段后间距：0.5行距 = 0.5 * 12pt = 6pt = 120 twips
      space_before: 120 # 单位：twips (1pt = 20 twips)
      space_after: 120

  - id: "FONT-002"
    enabled: true
    params:
      description: "作者信息格式：居中，华文楷体，西文Times New Roman，小4号"
      target_blocks: [1, 2, 3, 4] # 作者相关段落（块1-4）
      expected_font_name: "华文楷体"
      expected_font_size: 190500 # 小4号 = 12pt
      expected_alignment: "CENTER"
      font_name_alternatives: ["Times New Roman"] # 西文部分

  - id: "FONT-003"
    enabled: true
    params:
      description: "摘要和关键词必须使用华文楷体5号"
      keywords: ["摘要", "关键词", "Abstract", "Keywords"]
      expected_font_name: "华文楷体"
      expected_font_size: 158750 # 5号 = 10.5pt
      line_spacing: 1.15

  - id: "FONT-004"
    enabled: true
    params:
      description: "正文必须使用宋体5号或小4号"
      target_styles: ["Normal", "Body Text"]
      expected_font_name: "宋体"
      allowed_font_sizes: [158750, 190500] # 5号或小4号
      allow_font_alternatives: ["Times New Roman"]

  # ============================================================================
  # 8. 特殊章节规则
  # ============================================================================

  - id: "ACK-001"
    enabled: true
    params:
      description: "必须包含'致谢'章节"
      title_text: "致  谢"
      alternative_titles: ["致谢", "Acknowledgments", "Acknowledgements"]
      style_prefixes: ["Heading"]

  - id: "AUTH-001"
    enabled: true
    params:
      description: "必须包含'数据作者分工职责'章节"
      title_text: "数据作者分工职责"
      alternative_titles: ["作者贡献", "Author Contributions"]
      style_prefixes: ["Heading"]

  # ============================================================================
  # 9. 数值和单位规则
  # ============================================================================

  - id: "UNIT-001"
    enabled: true
    params:
      description: "数值和单位之间必须有空格"
      check_unit_spacing: true
      common_units: ["m", "km", "g", "kg", "℃", "°C", "%", "mm", "cm"]
      exceptions: ["%"] # 百分号不需要空格

  - id: "UNIT-002"
    enabled: true
    params:
      description: "检查是否有'量、单位和符号'说明章节"
      title_text: "量、单位和符号"
      alternative_titles: ["单位说明", "符号说明"]
      style_prefixes: ["Heading"]
      optional: true # 可选

# ============================================================================
# 全局设置
# ============================================================================
settings:
  # 严格模式：所有规则都必须通过
  strict_mode: false

  # 错误级别
  severity:
    structure_missing: "error" # 缺少必需章节
    heading_numbering: "warning" # 标题编号问题
    paragraph_format: "warning" # 段落格式问题
    font_style: "info" # 字体样式问题
    spacing: "info" # 间距问题

  # 忽略的样式
  ignore_styles:
    - "TOC 1"
    - "TOC 2"
    - "TOC 3"
    - "Header"
    - "Footer"
    - "Page Number"

  # 文档元数据
  metadata:
    template_name: "数据论文模板（刘尚亮修正版）"
    version: "1.0"
    last_updated: "2026-01-14"
    applicable_to: "科学数据论文"
