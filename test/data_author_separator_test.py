#!/usr/bin/env python3
"""
æ•°æ®ä½œè€…åˆ†éš”ç¬¦æµ‹è¯•

æµ‹è¯•è§„åˆ™ï¼š
æ•°æ®ä¿¡æ¯è¡¨ä¸­"æ•°æ®ä½œè€…"å­—æ®µçš„å¤šä¸ªä½œè€…å¿…é¡»ä½¿ç”¨ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰åˆ†éš”
"""

import re

def test_author_separator_format():
    """æµ‹è¯•æ•°æ®ä½œè€…åˆ†éš”ç¬¦æ ¼å¼"""
    
    print("=" * 80)
    print("æ•°æ®ä½œè€…åˆ†éš”ç¬¦æµ‹è¯•")
    print("=" * 80)
    print()
    
    # æµ‹è¯•ç”¨ä¾‹
    test_cases = [
        {
            "name": "åœºæ™¯1ï¼šå•ä¸ªä½œè€…ï¼ˆæ­£ç¡®ï¼‰",
            "text": "å¼ ä¸‰",
            "expected": True
        },
        {
            "name": "åœºæ™¯2ï¼šä¸¤ä¸ªä½œè€…ï¼Œä¸­æ–‡é¡¿å·ï¼ˆæ­£ç¡®ï¼‰",
            "text": "å¼ ä¸‰ã€æå››",
            "expected": True
        },
        {
            "name": "åœºæ™¯3ï¼šå¤šä¸ªä½œè€…ï¼Œä¸­æ–‡é¡¿å·ï¼ˆæ­£ç¡®ï¼‰",
            "text": "å¼ ä¸‰ã€æå››ã€ç‹äº”",
            "expected": True
        },
        {
            "name": "åœºæ™¯4ï¼šå¤šä¸ªä½œè€…ï¼Œä¸­æ–‡é¡¿å·ï¼ˆæ­£ç¡®ï¼‰",
            "text": "å¼ ä¸‰ã€æå››ã€ç‹äº”ã€èµµå…­",
            "expected": True
        },
        {
            "name": "åœºæ™¯5ï¼šä½¿ç”¨ä¸­æ–‡é€—å·ï¼ˆé”™è¯¯ï¼‰",
            "text": "å¼ ä¸‰ï¼Œæå››ï¼Œç‹äº”",
            "expected": False
        },
        {
            "name": "åœºæ™¯6ï¼šä½¿ç”¨è‹±æ–‡é€—å·ï¼ˆé”™è¯¯ï¼‰",
            "text": "å¼ ä¸‰, æå››, ç‹äº”",
            "expected": False
        },
        {
            "name": "åœºæ™¯7ï¼šä½¿ç”¨ä¸­æ–‡åˆ†å·ï¼ˆé”™è¯¯ï¼‰",
            "text": "å¼ ä¸‰ï¼›æå››ï¼›ç‹äº”",
            "expected": False
        },
        {
            "name": "åœºæ™¯8ï¼šä½¿ç”¨è‹±æ–‡åˆ†å·ï¼ˆé”™è¯¯ï¼‰",
            "text": "å¼ ä¸‰; æå››; ç‹äº”",
            "expected": False
        },
        {
            "name": "åœºæ™¯9ï¼šæ··ç”¨åˆ†éš”ç¬¦ï¼ˆé”™è¯¯ï¼‰",
            "text": "å¼ ä¸‰ã€æå››ï¼Œç‹äº”",
            "expected": False
        },
        {
            "name": "åœºæ™¯10ï¼šé¡¿å·åæœ‰ç©ºæ ¼ï¼ˆæ­£ç¡®ï¼‰",
            "text": "å¼ ä¸‰ã€ æå››ã€ ç‹äº”",
            "expected": True
        },
        {
            "name": "åœºæ™¯11ï¼šåŒ…å«è‹±æ–‡åå­—ï¼ˆæ­£ç¡®ï¼‰",
            "text": "Zhang Sanã€Li Siã€Wang Wu",
            "expected": True
        },
        {
            "name": "åœºæ™¯12ï¼šç©ºå­—ç¬¦ä¸²ï¼ˆè¾¹ç•Œæƒ…å†µï¼‰",
            "text": "",
            "expected": True  # ç©ºå­—ç¬¦ä¸²åŒ¹é… ^...*$
        },
    ]
    
    # æ­£åˆ™è¡¨è¾¾å¼
    # åŒ¹é…ï¼šå•ä¸ªä½œè€… æˆ– å¤šä¸ªä½œè€…ç”¨ä¸­æ–‡é¡¿å·åˆ†éš”
    # ä¸å…è®¸ï¼šä¸­æ–‡é€—å·ã€è‹±æ–‡é€—å·ã€ä¸­æ–‡åˆ†å·ã€è‹±æ–‡åˆ†å·
    pattern = r"^[^,ï¼Œ;ï¼›ã€]+([ã€][^,ï¼Œ;ï¼›ã€]+)*$"
    
    print("ğŸ“‹ æµ‹è¯•ç”¨ä¾‹ï¼š")
    print()
    print(f"æ­£åˆ™è¡¨è¾¾å¼: {pattern}")
    print()
    
    passed = 0
    failed = 0
    
    for test_case in test_cases:
        text = test_case['text']
        expected = test_case['expected']
        
        # æ£€æŸ¥æ˜¯å¦åŒ¹é…
        match = re.match(pattern, text) is not None
        
        # åˆ¤æ–­ç»“æœ
        is_correct = (match == expected)
        result = "âœ…" if is_correct else "âŒ"
        status = "é€šè¿‡" if is_correct else "å¤±è´¥"
        
        if is_correct:
            passed += 1
        else:
            failed += 1
        
        print(f"{result} {test_case['name']}")
        print(f"   æ–‡æœ¬: '{text}'")
        print(f"   é¢„æœŸ: {'åŒ¹é…' if expected else 'ä¸åŒ¹é…'}, å®é™…: {'åŒ¹é…' if match else 'ä¸åŒ¹é…'}")
        print()
    
    print("=" * 80)
    print(f"æµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")
    print("=" * 80)


def test_pattern_breakdown():
    """æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼åˆ†è§£"""
    
    print()
    print("=" * 80)
    print("æ­£åˆ™è¡¨è¾¾å¼è¯¦è§£")
    print("=" * 80)
    print()
    
    # å®Œæ•´çš„æ­£åˆ™è¡¨è¾¾å¼
    full_pattern = r"^[^,ï¼Œ;ï¼›ã€]+([ã€][^,ï¼Œ;ï¼›ã€]+)*$"
    
    print("æ­£åˆ™è¡¨è¾¾å¼åˆ†è§£ï¼š")
    print()
    print("  ^                          - å­—ç¬¦ä¸²å¼€å¤´")
    print("  [^,ï¼Œ;ï¼›ã€]+               - ç¬¬ä¸€ä¸ªä½œè€…å")
    print("                               ï¼ˆä¸åŒ…å«é€—å·ã€åˆ†å·ã€é¡¿å·çš„å­—ç¬¦ï¼‰")
    print("  (                          - å¼€å§‹æ•è·ç»„")
    print("    [ã€]                     - ä¸­æ–‡é¡¿å·")
    print("    [^,ï¼Œ;ï¼›ã€]+             - åç»­ä½œè€…å")
    print("  )*                         - é›¶æ¬¡æˆ–å¤šæ¬¡é‡å¤")
    print("  $                          - å­—ç¬¦ä¸²ç»“å°¾")
    print()
    
    print("ğŸ’¡ åŒ¹é…é€»è¾‘ï¼š")
    print("   1. ç¬¬ä¸€ä¸ªä½œè€…ï¼šä¸åŒ…å«ä»»ä½•åˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²")
    print("   2. åç»­ä½œè€…ï¼šä¸­æ–‡é¡¿å· + ä¸åŒ…å«åˆ†éš”ç¬¦çš„å­—ç¬¦ä¸²")
    print("   3. å¯ä»¥æœ‰é›¶ä¸ªæˆ–å¤šä¸ªåç»­ä½œè€…")
    print()
    
    print("=" * 80)


def test_separator_comparison():
    """æµ‹è¯•åˆ†éš”ç¬¦å¯¹æ¯”"""
    
    print()
    print("=" * 80)
    print("åˆ†éš”ç¬¦å¯¹æ¯”")
    print("=" * 80)
    print()
    
    separators = [
        {
            "åˆ†éš”ç¬¦": "ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰",
            "ç¤ºä¾‹": "å¼ ä¸‰ã€æå››ã€ç‹äº”",
            "æ˜¯å¦æ­£ç¡®": "âœ… æ­£ç¡®"
        },
        {
            "åˆ†éš”ç¬¦": "ä¸­æ–‡é€—å·ï¼ˆï¼Œï¼‰",
            "ç¤ºä¾‹": "å¼ ä¸‰ï¼Œæå››ï¼Œç‹äº”",
            "æ˜¯å¦æ­£ç¡®": "âŒ é”™è¯¯"
        },
        {
            "åˆ†éš”ç¬¦": "è‹±æ–‡é€—å·ï¼ˆ,ï¼‰",
            "ç¤ºä¾‹": "å¼ ä¸‰, æå››, ç‹äº”",
            "æ˜¯å¦æ­£ç¡®": "âŒ é”™è¯¯"
        },
        {
            "åˆ†éš”ç¬¦": "ä¸­æ–‡åˆ†å·ï¼ˆï¼›ï¼‰",
            "ç¤ºä¾‹": "å¼ ä¸‰ï¼›æå››ï¼›ç‹äº”",
            "æ˜¯å¦æ­£ç¡®": "âŒ é”™è¯¯"
        },
        {
            "åˆ†éš”ç¬¦": "è‹±æ–‡åˆ†å·ï¼ˆ;ï¼‰",
            "ç¤ºä¾‹": "å¼ ä¸‰; æå››; ç‹äº”",
            "æ˜¯å¦æ­£ç¡®": "âŒ é”™è¯¯"
        },
    ]
    
    print("ğŸ“Š åˆ†éš”ç¬¦å¯¹æ¯”ï¼š")
    print()
    
    for item in separators:
        print(f"   {item['æ˜¯å¦æ­£ç¡®']} {item['åˆ†éš”ç¬¦']}")
        print(f"      ç¤ºä¾‹: {item['ç¤ºä¾‹']}")
        print()
    
    print("=" * 80)


def test_table_structure():
    """æµ‹è¯•è¡¨æ ¼ç»“æ„"""
    
    print()
    print("=" * 80)
    print("è¡¨æ ¼ç»“æ„ï¼ˆKey-Valueæ¨¡å¼ï¼‰")
    print("=" * 80)
    print()
    
    print("ğŸ“Š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹è¡¨ç»“æ„ï¼š")
    print()
    print("   è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹")
    print("   " + "-" * 70)
    print("   | Key (ç¬¬ä¸€åˆ—)            | Value (ç¬¬äºŒåˆ—)                      |")
    print("   " + "-" * 70)
    print("   | æ•°æ®åº“ï¼ˆé›†ï¼‰åç§°        | åŒºå—é“¾æ™ºèƒ½åˆçº¦æ•°æ®åº“                |")
    print("   | æ•°æ®ä½œè€…               | å¼ ä¸‰ã€æå››ã€ç‹äº” â† ä½¿ç”¨ä¸­æ–‡é¡¿å·      |")
    print("   | æ‰€å±å­¦ç§‘               | è®¡ç®—æœºç§‘å­¦                          |")
    print("   | ...                    | ...                                |")
    print("   " + "-" * 70)
    print()
    
    print("ğŸ’¡ éªŒè¯é€»è¾‘ï¼š")
    print("   1. åœ¨ç¬¬ä¸€åˆ—ä¸­æŸ¥æ‰¾ key = 'æ•°æ®ä½œè€…'")
    print("   2. è·å–è¯¥è¡Œç¬¬äºŒåˆ—çš„ value")
    print("   3. æ£€æŸ¥ value æ˜¯å¦ä½¿ç”¨ä¸­æ–‡é¡¿å·åˆ†éš”")
    print()
    
    print("=" * 80)


def test_rule_configuration():
    """æµ‹è¯•è§„åˆ™é…ç½®"""
    
    print()
    print("=" * 80)
    print("è§„åˆ™é…ç½®è¯´æ˜")
    print("=" * 80)
    print()
    
    print("ğŸ“‹ è§„åˆ™é…ç½®ï¼ˆrules.yamlï¼‰ï¼š")
    print()
    print("   - id: r-043")
    print("     name: æ•°æ®ä½œè€…åˆ†éš”ç¬¦æ£€æŸ¥")
    print("     selector: '.data-info-table'")
    print("     check:")
    print("       table_cell_pattern:")
    print("         target_key_column: 0          # Keyåˆ—ï¼ˆç¬¬ä¸€åˆ—ï¼‰")
    print("         target_value_column: 1        # Valueåˆ—ï¼ˆç¬¬äºŒåˆ—ï¼‰")
    print("         target_key: 'æ•°æ®ä½œè€…'         # è¦æŸ¥æ‰¾çš„key")
    print("         pattern: '^[^,ï¼Œ;ï¼›ã€]+([ã€][^,ï¼Œ;ï¼›ã€]+)*$'")
    print("     severity: error")
    print()
    
    print("ğŸ” å‚æ•°è¯´æ˜ï¼š")
    print("   - target_key_column: Keyåˆ—ç´¢å¼•ï¼ˆç¬¬ä¸€åˆ—ï¼‰")
    print("   - target_value_column: Valueåˆ—ç´¢å¼•ï¼ˆç¬¬äºŒåˆ—ï¼‰")
    print("   - target_key: è¦æŸ¥æ‰¾çš„keyå€¼ï¼ˆ'æ•°æ®ä½œè€…'ï¼‰")
    print("   - pattern: æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ£€æŸ¥åˆ†éš”ç¬¦ï¼‰")
    print()
    
    print("ğŸ’¡ å·¥ä½œæµç¨‹ï¼š")
    print("   1. éå†è¡¨æ ¼çš„æ¯ä¸€è¡Œ")
    print("   2. æ£€æŸ¥ç¬¬ä¸€åˆ—ï¼ˆkeyåˆ—ï¼‰æ˜¯å¦ç­‰äº 'æ•°æ®ä½œè€…'")
    print("   3. å¦‚æœæ‰¾åˆ°ï¼Œè·å–è¯¥è¡Œç¬¬äºŒåˆ—ï¼ˆvalueåˆ—ï¼‰çš„å€¼")
    print("   4. ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥æ˜¯å¦ä½¿ç”¨ä¸­æ–‡é¡¿å·åˆ†éš”")
    print()
    
    print("=" * 80)


def test_common_errors():
    """æµ‹è¯•å¸¸è§é”™è¯¯"""
    
    print()
    print("=" * 80)
    print("å¸¸è§é”™è¯¯ç¤ºä¾‹")
    print("=" * 80)
    print()
    
    errors = [
        {
            "é”™è¯¯": "ä½¿ç”¨ä¸­æ–‡é€—å·",
            "é”™è¯¯ç¤ºä¾‹": "å¼ ä¸‰ï¼Œæå››ï¼Œç‹äº”",
            "æ­£ç¡®ç¤ºä¾‹": "å¼ ä¸‰ã€æå››ã€ç‹äº”",
            "è¯´æ˜": "å¿…é¡»ä½¿ç”¨ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨é€—å·"
        },
        {
            "é”™è¯¯": "ä½¿ç”¨è‹±æ–‡é€—å·",
            "é”™è¯¯ç¤ºä¾‹": "å¼ ä¸‰, æå››, ç‹äº”",
            "æ­£ç¡®ç¤ºä¾‹": "å¼ ä¸‰ã€æå››ã€ç‹äº”",
            "è¯´æ˜": "å¿…é¡»ä½¿ç”¨ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨è‹±æ–‡é€—å·"
        },
        {
            "é”™è¯¯": "ä½¿ç”¨åˆ†å·",
            "é”™è¯¯ç¤ºä¾‹": "å¼ ä¸‰ï¼›æå››ï¼›ç‹äº”",
            "æ­£ç¡®ç¤ºä¾‹": "å¼ ä¸‰ã€æå››ã€ç‹äº”",
            "è¯´æ˜": "å¿…é¡»ä½¿ç”¨ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰ï¼Œä¸èƒ½ä½¿ç”¨åˆ†å·"
        },
        {
            "é”™è¯¯": "æ··ç”¨åˆ†éš”ç¬¦",
            "é”™è¯¯ç¤ºä¾‹": "å¼ ä¸‰ã€æå››ï¼Œç‹äº”",
            "æ­£ç¡®ç¤ºä¾‹": "å¼ ä¸‰ã€æå››ã€ç‹äº”",
            "è¯´æ˜": "æ‰€æœ‰åˆ†éš”ç¬¦å¿…é¡»ç»Ÿä¸€ä½¿ç”¨ä¸­æ–‡é¡¿å·"
        },
    ]
    
    print("âŒ å¸¸è§é”™è¯¯ï¼š")
    print()
    
    for i, error in enumerate(errors, 1):
        print(f"{i}. {error['é”™è¯¯']}")
        print(f"   âŒ é”™è¯¯: {error['é”™è¯¯ç¤ºä¾‹']}")
        print(f"   âœ… æ­£ç¡®: {error['æ­£ç¡®ç¤ºä¾‹']}")
        print(f"   ğŸ’¡ è¯´æ˜: {error['è¯´æ˜']}")
        print()
    
    print("=" * 80)


def main():
    """ä¸»å‡½æ•°"""
    test_author_separator_format()
    test_pattern_breakdown()
    test_separator_comparison()
    test_table_structure()
    test_rule_configuration()
    test_common_errors()
    
    print()
    print("ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼")
    print()
    print("ğŸ“‹ é…ç½®æ€»ç»“ï¼š")
    print()
    print("1. è§„åˆ™é…ç½®ï¼ˆrules.yamlï¼‰ï¼š")
    print("   - r-043: æ•°æ®ä½œè€…åˆ†éš”ç¬¦æ£€æŸ¥")
    print()
    print("2. æ­£åˆ™è¡¨è¾¾å¼ï¼š")
    print("   ^[^,ï¼Œ;ï¼›ã€]+([ã€][^,ï¼Œ;ï¼›ã€]+)*$")
    print()
    print("3. æ ¼å¼è¦æ±‚ï¼š")
    print("   - å•ä¸ªä½œè€…ï¼šç›´æ¥å†™åå­—")
    print("   - å¤šä¸ªä½œè€…ï¼šä½¿ç”¨ä¸­æ–‡é¡¿å·ï¼ˆã€ï¼‰åˆ†éš”")
    print("   - ä¸å…è®¸ä½¿ç”¨ï¼šé€—å·ã€åˆ†å·ç­‰å…¶ä»–åˆ†éš”ç¬¦")
    print()
    print("4. æ­£ç¡®ç¤ºä¾‹ï¼š")
    print("   âœ… å¼ ä¸‰")
    print("   âœ… å¼ ä¸‰ã€æå››")
    print("   âœ… å¼ ä¸‰ã€æå››ã€ç‹äº”")
    print("   âœ… Zhang Sanã€Li Siã€Wang Wu")
    print()
    print("5. é”™è¯¯ç¤ºä¾‹ï¼š")
    print("   âŒ å¼ ä¸‰ï¼Œæå››ï¼Œç‹äº”ï¼ˆä½¿ç”¨ä¸­æ–‡é€—å·ï¼‰")
    print("   âŒ å¼ ä¸‰, æå››, ç‹äº”ï¼ˆä½¿ç”¨è‹±æ–‡é€—å·ï¼‰")
    print("   âŒ å¼ ä¸‰ï¼›æå››ï¼›ç‹äº”ï¼ˆä½¿ç”¨åˆ†å·ï¼‰")
    print("   âŒ å¼ ä¸‰ã€æå››ï¼Œç‹äº”ï¼ˆæ··ç”¨åˆ†éš”ç¬¦ï¼‰")
    print()


if __name__ == "__main__":
    main()
