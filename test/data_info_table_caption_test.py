#!/usr/bin/env python3
"""
æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹è¡¨é¢˜æ³¨å†…å®¹æµ‹è¯•

æµ‹è¯•è¡¨é¢˜æ³¨çš„å†…å®¹è§„åˆ™ï¼š
å†…å®¹å¿…é¡»æ˜¯"è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹"
"""

import re

def test_caption_content_format():
    """æµ‹è¯•è¡¨é¢˜æ³¨å†…å®¹æ ¼å¼"""
    
    print("=" * 80)
    print("æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹è¡¨é¢˜æ³¨å†…å®¹æµ‹è¯•")
    print("=" * 80)
    print()
    
    # æµ‹è¯•ç”¨ä¾‹
    test_cases = [
        {
            "name": "åœºæ™¯1ï¼šæ ‡å‡†æ ¼å¼ï¼ˆæ­£ç¡®ï¼‰",
            "text": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": True
        },
        {
            "name": "åœºæ™¯2ï¼šæ— ç©ºæ ¼ï¼ˆæ­£ç¡®ï¼‰",
            "text": "è¡¨1ï¼šæ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": True
        },
        {
            "name": "åœºæ™¯3ï¼šè‹±æ–‡å†’å·ï¼ˆæ­£ç¡®ï¼‰",
            "text": "è¡¨ 1: æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": True
        },
        {
            "name": "åœºæ™¯4ï¼šå¤šä¸ªç©ºæ ¼ï¼ˆæ­£ç¡®ï¼‰",
            "text": "è¡¨  1ï¼š  æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": True
        },
        {
            "name": "åœºæ™¯5ï¼šè¡¨å’Œ1ä¹‹é—´æ— ç©ºæ ¼ï¼ˆæ­£ç¡®ï¼‰",
            "text": "è¡¨1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": True
        },
        {
            "name": "åœºæ™¯6ï¼šé”™è¯¯çš„è¡¨å·ï¼ˆé”™è¯¯ï¼‰",
            "text": "è¡¨ 2ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": False
        },
        {
            "name": "åœºæ™¯7ï¼šç¼ºå°‘å†’å·ï¼ˆé”™è¯¯ï¼‰",
            "text": "è¡¨ 1 æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": False
        },
        {
            "name": "åœºæ™¯8ï¼šå†…å®¹ä¸å®Œæ•´ï¼ˆé”™è¯¯ï¼‰",
            "text": "è¡¨ 1ï¼š æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": False
        },
        {
            "name": "åœºæ™¯9ï¼šå¤šä½™å†…å®¹åœ¨å‰ï¼ˆé”™è¯¯ï¼‰",
            "text": "é™„å½• è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": False
        },
        {
            "name": "åœºæ™¯10ï¼šå¤šä½™å†…å®¹åœ¨åï¼ˆé”™è¯¯ï¼‰",
            "text": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹ï¼ˆç»­è¡¨ï¼‰",
            "expected": False
        },
        {
            "name": "åœºæ™¯11ï¼šé”™è¯¯çš„æ ‡ç‚¹ï¼ˆé”™è¯¯ï¼‰",
            "text": "è¡¨ 1. æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": False
        },
        {
            "name": "åœºæ™¯12ï¼šä½¿ç”¨Tableï¼ˆé”™è¯¯ï¼‰",
            "text": "Table 1: æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "expected": False
        },
    ]
    
    # æ­£åˆ™è¡¨è¾¾å¼
    pattern = r"^è¡¨\s*1\s*[ï¼š:]\s*æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹$"
    
    print("ğŸ“‹ æµ‹è¯•ç”¨ä¾‹ï¼š")
    print()
    print(f"æ­£åˆ™è¡¨è¾¾å¼: {pattern}")
    print()
    
    passed = 0
    failed = 0
    
    for test_case in test_cases:
        text = test_case['text']
        expected = test_case['expected']
        
        # æ£€æŸ¥æ˜¯å¦åŒ¹é…
        match = re.match(pattern, text) is not None
        
        # åˆ¤æ–­ç»“æœ
        is_correct = (match == expected)
        result = "âœ…" if is_correct else "âŒ"
        status = "é€šè¿‡" if is_correct else "å¤±è´¥"
        
        if is_correct:
            passed += 1
        else:
            failed += 1
        
        print(f"{result} {test_case['name']}")
        print(f"   æ–‡æœ¬: {text}")
        print(f"   é¢„æœŸ: {'åŒ¹é…' if expected else 'ä¸åŒ¹é…'}, å®é™…: {'åŒ¹é…' if match else 'ä¸åŒ¹é…'}")
        print()
    
    print("=" * 80)
    print(f"æµ‹è¯•ç»“æœ: {passed} é€šè¿‡, {failed} å¤±è´¥")
    print("=" * 80)


def test_pattern_breakdown():
    """æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼åˆ†è§£"""
    
    print()
    print("=" * 80)
    print("æ­£åˆ™è¡¨è¾¾å¼è¯¦è§£")
    print("=" * 80)
    print()
    
    # å®Œæ•´çš„æ­£åˆ™è¡¨è¾¾å¼
    full_pattern = r"^è¡¨\s*1\s*[ï¼š:]\s*æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹$"
    
    print("æ­£åˆ™è¡¨è¾¾å¼åˆ†è§£ï¼š")
    print()
    print("  ^                          - å­—ç¬¦ä¸²å¼€å¤´")
    print("  è¡¨                         - å›ºå®šæ–‡æœ¬'è¡¨'")
    print("  \\s*                        - é›¶ä¸ªæˆ–å¤šä¸ªç©ºæ ¼")
    print("  1                          - æ•°å­—'1'")
    print("  \\s*                        - é›¶ä¸ªæˆ–å¤šä¸ªç©ºæ ¼")
    print("  [ï¼š:]                      - ä¸­æ–‡å†’å·æˆ–è‹±æ–‡å†’å·")
    print("  \\s*                        - é›¶ä¸ªæˆ–å¤šä¸ªç©ºæ ¼")
    print("  æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹      - å›ºå®šæ–‡æœ¬")
    print("  $                          - å­—ç¬¦ä¸²ç»“å°¾")
    print()
    
    print("=" * 80)


def test_format_components():
    """æµ‹è¯•æ ¼å¼å„ä¸ªç»„æˆéƒ¨åˆ†"""
    
    print()
    print("=" * 80)
    print("æ ¼å¼ç»„æˆéƒ¨åˆ†æµ‹è¯•")
    print("=" * 80)
    print()
    
    print("æ ‡å‡†æ ¼å¼ï¼šè¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹")
    print()
    
    components = [
        {
            "name": "1. 'è¡¨'å­—",
            "pattern": r"^è¡¨",
            "tests": [
                ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("Table 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", False),
            ]
        },
        {
            "name": "2. è¡¨å·'1'",
            "pattern": r"^è¡¨\s*1",
            "tests": [
                ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("è¡¨1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("è¡¨ 2ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", False),
            ]
        },
        {
            "name": "3. å†’å·ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰",
            "pattern": r"^è¡¨\s*1\s*[ï¼š:]",
            "tests": [
                ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("è¡¨ 1: æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("è¡¨ 1. æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", False),
            ]
        },
        {
            "name": "4. å›ºå®šå†…å®¹",
            "pattern": r"^è¡¨\s*1\s*[ï¼š:]\s*æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "tests": [
                ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("è¡¨ 1ï¼š æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ç®€ä»‹", False),
            ]
        },
        {
            "name": "5. å­—ç¬¦ä¸²ç»“å°¾ï¼ˆä¸èƒ½æœ‰å¤šä½™å†…å®¹ï¼‰",
            "pattern": r"^è¡¨\s*1\s*[ï¼š:]\s*æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹$",
            "tests": [
                ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", True),
                ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹ï¼ˆç»­è¡¨ï¼‰", False),
            ]
        },
    ]
    
    for component in components:
        print(f"ğŸ” {component['name']}")
        print(f"   æ­£åˆ™: {component['pattern']}")
        print()
        
        for text, expected in component['tests']:
            match = re.match(component['pattern'], text) is not None
            result = "âœ…" if match == expected else "âŒ"
            status = "åŒ¹é…" if match else "ä¸åŒ¹é…"
            
            print(f"      {result} {text:45} {status}")
        
        print()
    
    print("=" * 80)


def test_common_errors():
    """æµ‹è¯•å¸¸è§é”™è¯¯"""
    
    print()
    print("=" * 80)
    print("å¸¸è§é”™è¯¯ç¤ºä¾‹")
    print("=" * 80)
    print()
    
    errors = [
        {
            "é”™è¯¯": "è¡¨å·é”™è¯¯",
            "é”™è¯¯ç¤ºä¾‹": "è¡¨ 2ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "æ­£ç¡®ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "è¯´æ˜": "å¿…é¡»æ˜¯è¡¨1ï¼Œä¸èƒ½æ˜¯å…¶ä»–æ•°å­—"
        },
        {
            "é”™è¯¯": "ç¼ºå°‘å†’å·",
            "é”™è¯¯ç¤ºä¾‹": "è¡¨ 1 æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "æ­£ç¡®ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "è¯´æ˜": "è¡¨å·åå¿…é¡»æœ‰å†’å·"
        },
        {
            "é”™è¯¯": "å†…å®¹ä¸å®Œæ•´",
            "é”™è¯¯ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "æ­£ç¡®ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "è¯´æ˜": "å¿…é¡»åŒ…å«'ï¼ˆé›†ï¼‰'"
        },
        {
            "é”™è¯¯": "ä½¿ç”¨è‹±æ–‡Table",
            "é”™è¯¯ç¤ºä¾‹": "Table 1: æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "æ­£ç¡®ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "è¯´æ˜": "å¿…é¡»ä½¿ç”¨ä¸­æ–‡'è¡¨'"
        },
        {
            "é”™è¯¯": "åŒ…å«å¤šä½™å†…å®¹",
            "é”™è¯¯ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹ï¼ˆç»­è¡¨ï¼‰",
            "æ­£ç¡®ç¤ºä¾‹": "è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹",
            "è¯´æ˜": "ä¸èƒ½æœ‰å¤šä½™çš„åç¼€"
        },
    ]
    
    print("âŒ å¸¸è§é”™è¯¯ï¼š")
    print()
    
    for i, error in enumerate(errors, 1):
        print(f"{i}. {error['é”™è¯¯']}")
        print(f"   âŒ é”™è¯¯: {error['é”™è¯¯ç¤ºä¾‹']}")
        print(f"   âœ… æ­£ç¡®: {error['æ­£ç¡®ç¤ºä¾‹']}")
        print(f"   ğŸ’¡ è¯´æ˜: {error['è¯´æ˜']}")
        print()
    
    print("=" * 80)


def test_flexible_spacing():
    """æµ‹è¯•ç©ºæ ¼çµæ´»æ€§"""
    
    print()
    print("=" * 80)
    print("ç©ºæ ¼çµæ´»æ€§æµ‹è¯•")
    print("=" * 80)
    print()
    
    pattern = r"^è¡¨\s*1\s*[ï¼š:]\s*æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹$"
    
    spacing_tests = [
        ("è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", "æ ‡å‡†æ ¼å¼ï¼ˆæœ‰ç©ºæ ¼ï¼‰"),
        ("è¡¨1ï¼šæ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", "æ— ç©ºæ ¼"),
        ("è¡¨  1ï¼š  æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", "å¤šä¸ªç©ºæ ¼"),
        ("è¡¨1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", "è¡¨å’Œ1ä¹‹é—´æ— ç©ºæ ¼"),
        ("è¡¨ 1:æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹", "å†’å·åæ— ç©ºæ ¼"),
    ]
    
    print("ğŸ“Š ç©ºæ ¼çµæ´»æ€§ï¼š")
    print()
    print("   æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ \\s* å…è®¸é›¶ä¸ªæˆ–å¤šä¸ªç©ºæ ¼")
    print()
    
    for text, desc in spacing_tests:
        match = re.match(pattern, text) is not None
        result = "âœ…" if match else "âŒ"
        print(f"   {result} {desc:25} {text}")
    
    print()
    print("=" * 80)


def main():
    """ä¸»å‡½æ•°"""
    test_caption_content_format()
    test_pattern_breakdown()
    test_format_components()
    test_common_errors()
    test_flexible_spacing()
    
    print()
    print("ğŸ‰ æ‰€æœ‰æµ‹è¯•å®Œæˆï¼")
    print()
    print("ğŸ“‹ é…ç½®æ€»ç»“ï¼š")
    print()
    print("1. å†…å®¹è§„åˆ™ï¼ˆrules.yamlï¼‰ï¼š")
    print("   - r-040: æ•°æ®ä¿¡æ¯è¡¨é¢˜æ³¨æ ¼å¼")
    print()
    print("2. æ­£åˆ™è¡¨è¾¾å¼ï¼š")
    print("   ^è¡¨\\s*1\\s*[ï¼š:]\\s*æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹$")
    print()
    print("3. æ ¼å¼è¦æ±‚ï¼š")
    print("   - å¿…é¡»ä»¥'è¡¨'å¼€å¤´")
    print("   - è¡¨å·å¿…é¡»æ˜¯'1'")
    print("   - è¡¨å·åå¿…é¡»æœ‰å†’å·ï¼ˆä¸­æ–‡æˆ–è‹±æ–‡ï¼‰")
    print("   - å›ºå®šå†…å®¹ï¼š'æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹'")
    print("   - ä¸èƒ½æœ‰å¤šä½™å†…å®¹")
    print()
    print("4. ç©ºæ ¼çµæ´»æ€§ï¼š")
    print("   - 'è¡¨'å’Œ'1'ä¹‹é—´å¯ä»¥æœ‰ç©ºæ ¼æˆ–æ— ç©ºæ ¼")
    print("   - '1'å’Œå†’å·ä¹‹é—´å¯ä»¥æœ‰ç©ºæ ¼æˆ–æ— ç©ºæ ¼")
    print("   - å†’å·åå¯ä»¥æœ‰ç©ºæ ¼æˆ–æ— ç©ºæ ¼")
    print()
    print("5. æ ‡å‡†æ ¼å¼ç¤ºä¾‹ï¼š")
    print("   âœ… è¡¨ 1ï¼š æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹")
    print("   âœ… è¡¨1ï¼šæ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹")
    print("   âœ… è¡¨ 1: æ•°æ®åº“ï¼ˆé›†ï¼‰åŸºæœ¬ä¿¡æ¯ç®€ä»‹")
    print()


if __name__ == "__main__":
    main()
