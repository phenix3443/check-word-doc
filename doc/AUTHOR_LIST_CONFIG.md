# 作者列表配置说明

## 格式要求

### 样式要求

- **对齐方式**：居中
- **字号**：小4号
- **中文字体**：华文楷体
- **西文字体**：Times New Roman

### 内容要求

#### 多个作者时

1. **分隔符**：作者之间必须使用中文逗号（，）分隔
2. **编号**：每个作者名后必须有数字编号（表示单位）
3. **通讯作者**：通讯作者的编号后必须有星号（*）

**示例**：
```
王嘉平1*，汪浩2
张三1*，李四2，王五3
```

#### 单个作者时

1. **编号**：作者名后必须有数字编号
2. **通讯作者**：可选星号标记

**示例**：
```
王嘉平1*
汪浩1
```

## 配置文件

### 1. 样式配置（styles.yaml）

```yaml
.author-list:
  font:
    name_eastasia: 华文楷体
    name_ascii: "Times New Roman"
    size: 小四
  paragraph:
    alignment: 居中
```

### 2. 内容规则（rules.yaml）

```yaml
# r-001: 作者列表格式规则（多作者）
- id: r-001
  name: 作者列表格式规则（多作者）
  description: 多个作者时，必须使用中文逗号分隔，每个作者名后必须有数字编号
  selector: ".author-list"
  condition:
    selector: ".author-list"
    pattern: "，"
  check:
    pattern: "^[^,;；、，]+\\d+[*]?(，[^,;；、，]+\\d+[*]?)*$"
  severity: error
  message: "多个作者时，必须使用中文逗号（，）分隔，每个作者名后必须有数字编号（如：王嘉平1*，汪浩2）"

# r-002: 作者列表格式规则（单作者）
- id: r-002
  name: 作者列表格式规则（单作者）
  description: 单个作者时，作者名后必须有数字编号
  selector: ".author-list"
  condition:
    selector: ".author-list"
    pattern: "^[^，]*$"
  check:
    pattern: "^[^,;；、，]+\\d+[*]?$"
  severity: error
  message: "作者名后必须有数字编号（如：王嘉平1*）"

# r-003: 通讯作者标记规则
- id: r-003
  name: 通讯作者标记规则
  description: 通讯作者的编号后必须有星号
  selector: ".author-list"
  check:
    pattern: "\\d+\\*"
  severity: error
  message: "通讯作者的编号后必须有星号（如：王嘉平1*）"
```

## 正则表达式详解

### 多作者格式

```regex
^[^,;；、，]+\d+[*]?(，[^,;；、，]+\d+[*]?)*$
```

**解释**：

| 部分 | 说明 |
|------|------|
| `^` | 字符串开始 |
| `[^,;；、，]+` | 作者名（不能包含任何分隔符） |
| `\d+` | 数字编号（必须有） |
| `[*]?` | 星号（可选，表示通讯作者） |
| `，` | 中文逗号（分隔符） |
| `(，[^,;；、，]+\d+[*]?)*` | 后续作者（重复模式） |
| `$` | 字符串结束 |

**匹配示例**：
- ✅ `王嘉平1*，汪浩2`
- ✅ `张三1*，李四2，王五3`
- ✅ `王嘉平1*，汪浩2*，张三3`
- ❌ `王嘉平1,汪浩2`（使用英文逗号）
- ❌ `王嘉平，汪浩2`（第一个作者缺少数字）
- ❌ `王嘉平1，汪浩`（第二个作者缺少数字）

### 单作者格式

```regex
^[^,;；、，]+\d+[*]?$
```

**解释**：

| 部分 | 说明 |
|------|------|
| `^` | 字符串开始 |
| `[^,;；、，]+` | 作者名（不能包含任何分隔符） |
| `\d+` | 数字编号（必须有） |
| `[*]?` | 星号（可选，表示通讯作者） |
| `$` | 字符串结束 |

**匹配示例**：
- ✅ `王嘉平1*`
- ✅ `汪浩1`
- ❌ `王嘉平`（缺少数字编号）
- ❌ `王嘉平*`（缺少数字编号）

## 规则工作原理

### 1. 条件判断

系统首先判断是单作者还是多作者：

```yaml
condition:
  selector: ".author-list"
  pattern: "，"  # 如果包含中文逗号，说明是多作者
```

### 2. 格式检查

根据判断结果，应用不同的正则表达式：

- **多作者**：`^[^,;；、，]+\d+[*]?(，[^,;；、，]+\d+[*]?)*$`
- **单作者**：`^[^,;；、，]+\d+[*]?$`

### 3. 错误提示

如果格式不符合要求，系统会显示相应的错误消息：

- 多作者：`"多个作者时，必须使用中文逗号（，）分隔，每个作者名后必须有数字编号（如：王嘉平1*，汪浩2）"`
- 单作者：`"作者名后必须有数字编号（如：王嘉平1*）"`

## 常见错误

### 错误 1：使用错误的分隔符

❌ **错误**：
```
王嘉平1*,汪浩2      # 使用英文逗号
王嘉平1*;汪浩2      # 使用分号
王嘉平1*、汪浩2     # 使用顿号
```

✅ **正确**：
```
王嘉平1*，汪浩2     # 使用中文逗号
```

### 错误 2：缺少数字编号

❌ **错误**：
```
王嘉平，汪浩2       # 第一个作者缺少数字
王嘉平1*，汪浩      # 第二个作者缺少数字
王嘉平              # 单作者缺少数字
```

✅ **正确**：
```
王嘉平1*，汪浩2     # 所有作者都有数字
王嘉平1*            # 单作者有数字
```

### 错误 3：通讯作者缺少星号

❌ **错误**：
```
王嘉平1，汪浩2      # 如果王嘉平是通讯作者，缺少星号
```

✅ **正确**：
```
王嘉平1*，汪浩2     # 通讯作者有星号
```

## 测试用例

完整的测试用例请参考：`test/author_list_test.py`

运行测试：

```bash
poetry run python3 test/author_list_test.py
```

预期输出：

```
================================================================================
作者列表格式测试
================================================================================

📋 测试用例：

✅ [PASS] (单作者) 单作者，有星号（通讯作者）
✅ [PASS] (单作者) 单作者，无星号
✅ [PASS] (多作者) 两个作者，第一作者是通讯作者
✅ [PASS] (多作者) 两个作者，第二作者是通讯作者
✅ [PASS] (多作者) 三个作者，第一作者是通讯作者
✅ [PASS] (多作者) 三个作者，两个通讯作者
✅ [PASS] (单作者) ❌ 缺少数字编号
✅ [PASS] (单作者) ❌ 缺少数字编号（只有星号）
✅ [PASS] (单作者) ❌ 使用英文逗号
✅ [PASS] (单作者) ❌ 使用分号
✅ [PASS] (单作者) ❌ 使用顿号
✅ [PASS] (多作者) ❌ 第二个作者缺少数字
✅ [PASS] (多作者) ❌ 第一个作者缺少数字

================================================================================
测试结果: 13 通过, 0 失败
================================================================================

🎉 所有测试通过！
```

## 总结

通过配置文件和正则表达式，我们实现了对作者列表格式的完整检查：

1. ✅ **样式检查**：字体、字号、对齐方式
2. ✅ **分隔符检查**：必须使用中文逗号
3. ✅ **编号检查**：每个作者必须有数字编号
4. ✅ **通讯作者检查**：通讯作者必须有星号标记
5. ✅ **单/多作者区分**：自动判断并应用不同规则

所有规则都通过正则表达式实现，无需硬编码！🎉
