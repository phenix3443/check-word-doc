# 文档格式检查项目任务计划

## 项目概述

本项目旨在检查 Word 文档的格式规范性，包括封面、目录、图目录、表目录、正文段落、正文标题、参考文献、附件、页眉、页脚、页码等文档元素。检查规则通过 YAML 配置文件进行管理，便于灵活配置和扩展。

## 测试文件

/Users/lsl/nuts/我的坚果云/idea/yanshou/项目验收-22 年项目-科技报告-20251230-v9.docx

## 任务列表

### Task 1: 设计 YAML 配置文件结构

- [x] 定义配置文件的基本结构
- [x] 设计各检查项的配置格式（封面、目录、图目录、表目录、正文段落、正文标题、图表题注、参考文献、附件、页眉、页脚、页码等）
- [x] 定义检查规则的数据结构（格式要求、验证规则、错误提示等）
- [x] 创建示例配置文件

### Task 2: 实现配置文件加载和解析模块

- [x] 创建配置文件读取模块
- [x] 实现 YAML 文件解析功能
- [x] 实现配置验证和错误处理
- [x] 提供默认配置选项

### Task 3: 实现封面检查功能

- [x] 识别文档封面（通常在第一页或特定位置）
- [x] 检查封面必需元素（标题、作者、日期等）
- [x] 检查封面格式（字体、字号、对齐方式等）
- [x] 生成封面检查报告

### Task 4: 实现目录检查功能

- [x] 识别文档目录部分
  - 自动识别"目录"、"图目录"、"表目录"等章节标题
  - 定位目录部分的起始段落位置
- [x] 检查目录顺序（并行执行）
  - 验证目录、图目录、表目录的排列顺序是否正确
  - 检查是否符合配置文件中定义的顺序（默认：目录 → 图目录 → 表目录）
  - **并行优化**：与其他检查项并行执行，提高效率
- [x] 检查目录格式（并行执行）
  - **字体检查**：验证各级目录项（TOC1、TOC2、TOC3）的字体是否符合要求（默认：宋体）
  - **字号检查**：验证各级目录项的字号是否符合要求（默认：12 号）
  - **对齐方式检查**：验证目录项的对齐方式（默认：左对齐）
  - **缩进检查**：
    - TOC1（一级）：首行缩进 0
    - TOC2（二级）：左缩进 35.7pt，悬挂缩进 17.85pt
    - TOC3（三级）：左缩进 28.35pt，首行缩进 17.85pt
  - **并行优化**：
    - 段落级并行：当目录项数量 > 10 时，使用 4 个工作线程并行检查段落格式
    - 检查项级并行：格式、编号、页码检查并行执行
- [x] 检查目录编号连续性（并行执行）
  - 验证目录编号是否连续递增（如：1, 1.1, 1.2, 2 等）
  - 检查多级编号的层次结构是否正确
  - 识别编号跳跃、重复或不连续的问题
  - 支持配置启用/禁用此检查项
  - **并行优化**：与格式检查、页码检查并行执行
- [x] 检查目录页码准确性（并行执行）
  - 验证目录中显示的页码是否与实际页码匹配
  - 允许合理的误差范围（默认：±2 页）
  - 识别页码不匹配的目录项
  - 支持配置启用/禁用此检查项
  - **并行优化**：与格式检查、编号检查并行执行
- [ ] 验证目录项与正文标题的对应关系
  - 检查目录项是否在正文中存在对应的标题
  - 验证目录项标题与正文标题是否一致

**并行检查策略**：

- 所有目录检查任务（顺序、格式、编号连续性、页码准确性）使用 `ThreadPoolExecutor` 并行执行
- 使用 4 个工作线程同时执行不同的检查任务
- 段落格式检查在目录项数量较多时自动启用并行处理
- 显著提高大型文档的检查速度

### Task 5: 实现图目录检查功能

- [ ] 识别图目录部分
- [ ] 提取文档中所有图片和图表
- [ ] 验证图目录项与正文中图片的对应关系
- [ ] 检查图目录格式（编号、标题、页码等）
- [ ] 检查图片编号的连续性和格式

### Task 6: 实现表目录检查功能

- [ ] 识别表目录部分
- [ ] 提取文档中所有表格
- [ ] 验证表目录项与正文中表格的对应关系
- [ ] 检查表目录格式（编号、标题、页码等）
- [ ] 检查表格编号的连续性和格式

### Task 7: 实现图表题注格式检查功能

- [ ] 识别文档中所有图表题注（图和表的题注）
- [ ] 检查题注格式（字体、字号、对齐方式等）
- [ ] 验证题注格式一致性（所有题注应使用相同格式）
- [ ] 检查题注编号格式的规范性
- [ ] 生成图表题注格式检查报告

### Task 8: 实现正文段落格式检查功能

- [ ] 识别正文段落（排除封面、目录、参考文献等特殊部分）
- [ ] 检查段落格式（字体、字号、行距、首行缩进等）
- [ ] 检查段落对齐方式
- [ ] 检查段落间距
- [ ] 支持多种段落格式规则配置

### Task 9: 实现正文标题格式检查功能

- [ ] 识别正文中的各级标题
- [ ] 检查标题级别和层次结构
- [ ] 检查标题格式（字体、字号、加粗、对齐等）
- [ ] 检查标题编号格式（如：1.1、1.1.1 等）
- [ ] 验证标题编号的连续性和正确性
- [ ] 检查标题前后的间距

### Task 10: 增强参考文献检查功能

- [ ] 整合现有的参考文献检查代码
- [ ] 支持通过配置文件自定义参考文献格式要求
- [ ] 检查参考文献列表格式（编号、对齐、字体等）
- [ ] 检查参考文献引用格式（正文中的引用标记）
- [ ] 验证参考文献编号的连续性

### Task 11: 实现附件检查功能

- [ ] 识别文档附件部分
- [ ] 检查附件标题格式
- [ ] 检查附件编号和命名规范
- [ ] 验证附件内容的完整性

### Task 12: 增强页眉页脚检查功能

- [ ] 整合现有的页眉页脚检查代码
- [ ] 支持通过配置文件自定义页眉页脚格式要求
- [ ] 检查不同章节的页眉页脚是否一致
- [ ] 检查页眉页脚内容格式（字体、字号、对齐等）

### Task 13: 实现页码检查功能

- [ ] 提取文档页码信息
- [ ] 检查页码格式（位置、样式、字体等）
- [ ] 检查页码连续性（从封面、目录、正文等不同部分）
- [ ] 检查页码起始位置和编号规则
- [ ] 验证页码与目录、图目录、表目录的一致性

### Task 14: 重构代码架构

- [ ] 创建统一的检查器基类
- [ ] 将各个检查功能模块化
- [ ] 实现检查器的注册和调用机制
- [ ] 统一错误处理和结果返回格式
- [ ] 优化代码结构，提高可维护性

### Task 15: 实现统一的报告生成系统

- [ ] 设计统一的报告格式
- [ ] 整合所有检查项的报告生成
- [ ] 支持 Markdown 和 HTML 格式报告
- [ ] 实现报告模板系统
- [ ] 添加检查结果统计和汇总
- [ ] 确保报告输出到 `report/` 目录

### Task 16: 创建主程序入口

- [ ] 实现命令行参数解析
- [ ] 支持指定文档路径和配置文件路径
- [ ] 实现批量文档检查功能
- [ ] 添加进度显示和日志输出
- [ ] 实现检查结果的保存和导出
- [ ] 确保所有脚本位于 `script/` 目录
- [ ] 确保所有报告输出到 `report/` 目录

### Task 17: 编写文档和示例

- [ ] 编写项目 README
- [ ] 编写配置文件使用说明
- [ ] 创建配置文件示例
- [ ] 编写使用教程和最佳实践
- [ ] 添加代码注释和文档字符串

### Task 18: 测试和优化

- [ ] 编写单元测试
- [ ] 测试各种文档格式和边界情况
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] 用户体验优化

## 项目目录结构

```text
check-word-doc/
├── script/              # 检查脚本目录
│   ├── check_document_format.py    # 文档格式检查脚本（现有）
│   ├── references.py               # 参考文献检查脚本（现有）
│   └── ...                         # 其他检查脚本
├── report/             # 检查报告输出目录
│   └── ...                         # 生成的检查报告文件
├── doc/                # 项目文档目录
│   └── plan.md                      # 项目计划文档
├── config/             # 配置文件目录（待创建）
│   └── default.yaml                 # 默认配置文件
└── README.md           # 项目说明文档
```

**目录说明：**

- `script/`: 存放所有检查脚本，包括格式检查、参考文献检查等
- `report/`: 存放生成的检查报告（Markdown 或 HTML 格式）
- `doc/`: 存放项目文档和计划
- `config/`: 存放 YAML 配置文件（将在 Task 1-2 中创建）

## 技术栈

- Python 3.x
- python-docx 或直接解析 docx XML（当前使用 zipfile + xml.etree.ElementTree）
- PyYAML（用于配置文件解析）
- 其他必要的依赖库

## 配置文件示例结构（初步设计）

```yaml
# 检查项开关
checks:
  cover: true
  table_of_contents: true
  figure_list: true
  table_list: true
  body_paragraphs: true
  body_headings: true
  captions: true
  references: true
  attachments: true
  headers: true
  footers: true
  page_numbers: true

# 封面检查配置
cover:
  required_elements:
    - title
    - author
    - date
  format:
    title:
      font: "宋体"
      size: 22
      bold: true
      alignment: center

# 目录检查配置
table_of_contents:
  required: true
  format:
    font: "宋体"
    size: 12
    alignment: left

# 正文段落配置
body_paragraphs:
  format:
    font: "宋体"
    size: 12
    line_spacing: 1.5
    first_line_indent: 2
    alignment: justify

# 图表题注配置
captions:
  figure:
    format:
      font: "宋体"
      size: 5
      alignment: center
  table:
    format:
      font: "宋体"
      size: 5
      alignment: center

# 正文标题配置
body_headings:
  levels:
    - level: 1
      font: "黑体"
      size: 16
      bold: true
      alignment: left
      numbering_format: "1"
    - level: 2
      font: "黑体"
      size: 14
      bold: true
      alignment: left
      numbering_format: "1.1"
```

## 注意事项

1. 保持与现有代码的兼容性
2. 配置文件应支持灵活的自定义规则
3. 检查结果应提供详细的位置信息（页码、段落号等）
4. 报告应清晰易读，便于用户定位问题
5. 代码应具有良好的扩展性，便于添加新的检查项
