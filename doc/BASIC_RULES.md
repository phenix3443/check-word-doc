# 基本文档格式规则

本文档说明所有文档都必须遵守的基本格式规则。这些规则定义在 `config/common/basic_rules.yaml` 中，会被自动导入到所有文档模板配置中。

## 目录

- [规则概述](#规则概述)
- [中文格式规则](#中文格式规则)
- [标点符号规则](#标点符号规则)
- [连续标点规则](#连续标点规则)
- [中英文混排规则](#中英文混排规则)
- [标点符号使用规则](#标点符号使用规则)
- [数字和单位规则](#数字和单位规则)
- [特殊字符规则](#特殊字符规则)
- [行首和行尾规则](#行首和行尾规则)
- [特殊格式规则](#特殊格式规则)

---

## 规则概述

### 规则统计

- **总数**: 23个基本规则
- **错误级别** (error): 8个 - 必须修复
- **警告级别** (warning): 11个 - 强烈建议修复
- **提示级别** (info): 4个 - 建议性规则

### 严重程度说明

- **error**: 严重错误，必须修复，会影响文档的正确性和规范性
- **warning**: 警告，强烈建议修复，可能影响文档的专业性
- **info**: 提示，建议性规则，在某些情况下可能不适用

---

## 中文格式规则

### r-basic-001: 中文不能被英文引号包围 [error]

**说明**: 中文文本不应该被英文单引号或双引号包围，应使用中文引号。

**正则**: `^(?!.*['\"][\u4e00-\u9fa5]+['\"]).*$`

**示例**:
- ❌ 错误: `"中文"` 或 `'中文'`
- ✅ 正确: `"中文"` 或 `「中文」`

### r-basic-002: 中文之间不能有空格 [error]

**说明**: 中文字符之间不应该有空格。

**正则**: `^(?!.*[\u4e00-\u9fa5]\s+[\u4e00-\u9fa5]).*$`

**示例**:
- ❌ 错误: `这是 中文`
- ✅ 正确: `这是中文`

**注意**: 中英文之间、中文和数字之间可以有空格。

---

## 标点符号规则

### r-basic-011: 中文标点后不应有多余空格 [warning]

**说明**: 中文标点符号（，。；：！？）后面不应该有空格。

**正则**: `^(?!.*[，。；：！？]\s+[\u4e00-\u9fa5]).*$`

**示例**:
- ❌ 错误: `内容， 继续`
- ✅ 正确: `内容，继续`

**注意**: 中文标点后接英文时可以有空格。

### r-basic-012: 中文标点前不应有空格 [warning]

**说明**: 中文标点符号（，。；：！？）前面不应该有空格。

**正则**: `^(?!.*[\u4e00-\u9fa5]\s+[，。；：！？]).*$`

**示例**:
- ❌ 错误: `内容 ，继续`
- ✅ 正确: `内容，继续`

### r-basic-013: 数字和中文单位之间不应有空格 [warning]

**说明**: 数字和中文单位（个、条、项、次等）之间不应该有空格。

**正则**: `^(?!.*\d+\s+[个条项次篇章节页行列]).*$`

**示例**:
- ❌ 错误: `3 个`
- ✅ 正确: `3个`

**注意**: 数字和英文单位之间应该有空格（如 `100 KB`）。

---

## 连续标点规则

### r-basic-014: 不应有连续的逗号 [error]

**说明**: 不应该出现连续的逗号。

**正则**: `^(?!.*[,，]{2,}).*$`

**示例**:
- ❌ 错误: `内容,,继续` 或 `内容，，继续`
- ✅ 正确: `内容，继续`

### r-basic-015: 不应有连续的句号 [error]

**说明**: 不应该出现连续的句号。

**正则**: `^(?!.*[.。]{2,}).*$`

**示例**:
- ❌ 错误: `内容..` 或 `内容。。`
- ✅ 正确: `内容。`

**注意**: 省略号（...）除外。

### r-basic-016: 不应有连续的空格 [warning]

**说明**: 不应该出现连续的空格。

**正则**: `^(?!.*\s{2,}).*$`

**示例**:
- ❌ 错误: `这是  内容`（两个空格）
- ✅ 正确: `这是 内容`（一个空格）

---

## 中英文混排规则

### r-basic-017: 中文和英文之间应该有空格 [info]

**说明**: 中文和英文字母之间应该有一个空格。

**正则**: `^(?!.*[\u4e00-\u9fa5][a-zA-Z])(?!.*[a-zA-Z][\u4e00-\u9fa5]).*$`

**示例**:
- ❌ 不推荐: `这是English内容`
- ✅ 推荐: `这是 English 内容`

**注意**: 这是建议性规则，某些情况下可能不适用。

### r-basic-018: 中文和数字之间应该有空格 [info]

**说明**: 中文和数字之间应该有一个空格（数字+单位除外）。

**正则**: `^(?!.*[\u4e00-\u9fa5]\d)(?!.*\d[\u4e00-\u9fa5]).*$`

**示例**:
- ❌ 不推荐: `共有100个`
- ✅ 推荐: `共有 100 个`
- ✅ 例外: `100个`（数字+单位不需要空格）

**注意**: 这是建议性规则，数字+单位的情况除外。

---

## 标点符号使用规则

### r-basic-019: 中文句子应使用中文标点 [warning]

**说明**: 中文句子中应使用中文标点符号，不应使用英文标点。

**正则**: `^(?!.*[\u4e00-\u9fa5]+[,;:!?][\u4e00-\u9fa5]).*$`

**示例**:
- ❌ 错误: `这是内容,继续`（英文逗号）
- ✅ 正确: `这是内容，继续`（中文逗号）

### r-basic-020: 省略号格式 [warning]

**说明**: 省略号应该使用六个点（……）或三个点（...）。

**示例**:
- ❌ 错误: `内容..继续`（两个点）
- ✅ 正确: `内容...继续`（三个点）
- ✅ 正确: `内容……继续`（中文省略号）

### r-basic-021: 破折号格式 [info]

**说明**: 破折号应该使用——而不是单个-。

**正则**: `^(?!.*[\u4e00-\u9fa5]-[\u4e00-\u9fa5]).*$`

**示例**:
- ❌ 不推荐: `内容-说明`
- ✅ 推荐: `内容——说明`

---

## 数字和单位规则

### r-basic-022: 数字和英文单位之间应该有空格 [info]

**说明**: 数字和英文单位（如KB、MB、GB等）之间应该有空格。

**正则**: `^(?!.*\d+[A-Z]{1,3}(?![a-z])).*$`

**示例**:
- ❌ 不推荐: `100KB`
- ✅ 推荐: `100 KB`
- ❌ 不推荐: `1.5GB`
- ✅ 推荐: `1.5 GB`

### r-basic-023: 百分号前不应有空格 [warning]

**说明**: 数字和百分号之间不应该有空格。

**正则**: `^(?!.*\d+\s+%).*$`

**示例**:
- ❌ 错误: `50 %`
- ✅ 正确: `50%`

---

## 特殊字符规则

### r-basic-024: 不应使用全角字母 [error]

**说明**: 不应该使用全角字母，应使用半角字母。

**正则**: `^(?!.*[ａ-ｚＡ-Ｚ]).*$`

**示例**:
- ❌ 错误: `Ｅｎｇｌｉｓｈ`（全角）
- ✅ 正确: `English`（半角）

### r-basic-025: 不应使用全角数字 [error]

**说明**: 不应该使用全角数字，应使用半角数字。

**正则**: `^(?!.*[０-９]).*$`

**示例**:
- ❌ 错误: `１２３`（全角）
- ✅ 正确: `123`（半角）

### r-basic-026: 不应混用中英文标点 [warning]

**说明**: 同一句子中不应混用中英文标点。

**正则**: `^(?!.*[，。；：！？].*[,\.;:!?])(?!.*[,\.;:!?].*[，。；：！？]).*$`

**示例**:
- ❌ 错误: `这是内容，继续.`（混用中英文标点）
- ✅ 正确: `这是内容，继续。`（统一使用中文标点）

---

## 行首和行尾规则

### r-basic-027: 行首不应有标点符号 [error]

**说明**: 段落开头不应该是标点符号。

**正则**: `^(?![，。；：！？、,\.;:!?]).*$`

**示例**:
- ❌ 错误: `，这是内容`
- ✅ 正确: `这是内容`

### r-basic-028: 行尾不应有空格 [warning]

**说明**: 段落结尾不应该有空格。

**正则**: `^.*[^\s]$`

**示例**:
- ❌ 错误: `这是内容 `（结尾有空格）
- ✅ 正确: `这是内容`

### r-basic-029: 行首不应有多余空格 [warning]

**说明**: 段落开头不应该有多余空格（首行缩进除外）。

**正则**: `^(?!\s{3,}).*$`

**示例**:
- ❌ 错误: `   这是内容`（3个以上空格）
- ✅ 正确: `  这是内容`（2个空格，首行缩进）
- ✅ 正确: `这是内容`（无空格）

---

## 特殊格式规则

### r-basic-030: URL格式检查 [info]

**说明**: URL应该是有效的格式，中间不应该有空格。

**正则**: `^(?!.*https?://[^\s]*\s[^\s]).*$`

**示例**:
- ❌ 错误: `https://example .com`
- ✅ 正确: `https://example.com`

### r-basic-031: 邮箱格式基本检查 [warning]

**说明**: 邮箱地址应该是有效的格式。

**正则**: `^(?!.*[a-zA-Z0-9][\u4e00-\u9fa5]+@).*$`

**示例**:
- ❌ 错误: `user中文@example.com`
- ✅ 正确: `user@example.com`

---

## 使用方法

### 在文档模板中导入

基本规则会自动被导入到所有文档模板配置中：

```yaml
# config/template/your_template/config.yaml
import:
  # 1. 基本规则（所有文档都必须遵守）
  - ../../common/basic_rules.yaml
  
  # 2. 其他配置...
  - classifiers.yaml
  - styles.yaml
  - rules.yaml
```

### 验证配置

```bash
poetry run python3 -c "
from script.config_loader import ConfigLoader
loader = ConfigLoader('config/template/data_paper/config.yaml')
config = loader.load()
rules = config.get('document', {}).get('rules', [])
basic_rules = [r for r in rules if r.get('id', '').startswith('r-basic-')]
print(f'基本规则数量: {len(basic_rules)}')
"
```

---

## 规则优先级

当基本规则与特定文档规则冲突时：

1. **基本规则优先**: 基本规则定义了最低标准，所有文档都必须遵守
2. **特定规则补充**: 特定文档规则在基本规则之上添加额外要求
3. **不应覆盖**: 特定文档规则不应该放宽基本规则的要求

---

## 扩展基本规则

如果需要添加新的基本规则：

1. 编辑 `config/common/basic_rules.yaml`
2. 添加新规则，使用 `r-basic-XXX` 格式的ID
3. 选择合适的严重程度（error/warning/info）
4. 添加清晰的描述和示例
5. 更新本文档

---

## 注意事项

1. **正则表达式限制**: 某些复杂规则（如引号嵌套、括号匹配）无法用简单正则表达式实现，建议在代码层面实现

2. **建议性规则**: 标记为 `info` 的规则是建议性的，在某些特殊情况下可能不适用

3. **性能考虑**: 基本规则会应用到所有段落，应该保持高效

4. **文化差异**: 某些规则可能因地区或领域而有所不同，可以根据实际情况调整

---

## 参考资源

- [中文文案排版指北](https://github.com/sparanoid/chinese-copywriting-guidelines)
- [中文技术文档的写作规范](https://github.com/ruanyf/document-style-guide)
- [GB/T 15834-2011 标点符号用法](http://www.moe.gov.cn/ewebeditor/uploadfile/2015/01/13/20150113091548267.pdf)

---

**版本**: 1.0  
**最后更新**: 2026-01-17
